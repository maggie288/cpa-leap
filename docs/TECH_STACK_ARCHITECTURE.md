# 技术选型与架构（V1 -> V2）

## 1. 技术选型

### 前端（已落地）
- `React + TypeScript + Vite`
- `React Router`：H5 页面路由
- `localStorage`：V1 本地持久化用户、进度、订阅
- `dayjs`：日期处理（考试倒计时、学习时间）

### 后端（V2 推荐）
- `Node.js (NestJS/Express)` + `PostgreSQL`
- `Redis`：会话、限流、学习会话缓存
- `对象存储`：题目素材、讲义资源

### AI 层（V2 推荐）
- 模型网关（OpenAI-compatible API）
- Prompt 模板中心 + 规则引擎
- 课程/题目质检服务（术语校验、答案一致性、难度校准）
- 自动教研流水线（生成 -> 质检 -> 自修复 -> 自动审核）
- 反馈学习闭环（学员弱项回流 -> 下一轮生成增强）
- 模型A/B实验分流（按用户流量分配模型版本）
- 按模型效果评估（自动通过率、质量分、学员得分）

## 2. 系统架构

1. **H5 前端层**
   - 登录、课程路径、学习页、订阅页、个人页
   - 负责交互和可视化反馈

2. **业务服务层（V2）**
   - 用户服务：鉴权、档案、订阅状态
   - 学习服务：进度、错题、复习计划
   - 课程服务：课程树、课时版本管理

3. **AI 生成层（V2）**
   - 生成入口：根据课时与用户画像产出脚本和题目
   - 质检与重试：答案校验、考点覆盖率校验
   - 版本管理：记录 prompt 与模型版本

4. **数据层**
   - 用户、订阅、进度、题目、生成日志
   - 指标埋点与分析（学习漏斗、转化漏斗）

## 3. 关键数据模型

- `users`：账户信息、目标考试日期、订阅档位
- `user_progress`：已完成课时、XP、薄弱点、最近学习时间
- `course_units` / `lessons`：课程内容结构化存储
- `question_bank`：题干、选项、答案、解析、难度
- `generation_logs`：输入参数、模型输出、质检结果

## 4. 安全与准确性策略

1. 前端不直接暴露真实模型密钥（V2 统一走后端网关）
2. LLM 输出必须经过规则校验：
   - 单选题只有一个正确答案
   - 解析与答案一致
   - 税法/会计等公式与条文术语命中词典
3. 高风险知识点（税率、法条时间点）采用“检索增强 + 固定题库优先”。
4. 对用户输入做风控和节流，防止滥用 API。

## 5. 扩展路线

- V1：本地可运行学习闭环（已开始）
- V1.5：接真实鉴权 + 云数据库
- V2：接支付、模型网关、课程质检
- V3：教研后台、运营后台、AB 测试与推荐系统
